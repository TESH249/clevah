<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>CLEVA Huixquilucan - Iniciar Sesión</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <div class="logo-nav">
      <h1>CLEVA <span>Huixquilucan</span></h1>
      <nav>
        <ul>
          <li><a href="index.html">Inicio</a></li>
          <li><a href="#">Nosotros</a></li>
          <li><a href="#">Tratamientos</a></li>
          <li><a href="#">Dentistas</a></li>
          <li><a href="login.html">Iniciar Sesión</a></li>
          <li><a href="agendar-cita.html">Agendar Cita</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section class="login-section">
      <div class="login-card">
        <h2>Iniciar Sesión</h2>

        <div id="cliente-login" style="display:none;">
          <button id="google-full-login" class="google-full-btn">Iniciar sesión con Google</button>
        </div>

        <div id="dentista-login" style="display:none;">
          <input type="email" placeholder="Correo del dentista" id="dentist-email">
          <input type="password" placeholder="Contraseña" id="dentist-password">
          <button class="dentist-submit-btn" id="dentist-submit">Iniciar Sesión</button>
        </div>

        <p>¿No tienes cuenta? <a href="#" id="show-register">Crear una nueva cuenta</a></p>
        <div id="register-form" style="display:none;">
          <input type="text" placeholder="Nombre" id="register-name">
          <input type="email" placeholder="Correo" id="register-email">
          <input type="password" placeholder="Contraseña" id="register-password">
          <button class="register-btn" id="register-submit">Registrarse</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Selector desde index.html
    const hash = window.location.hash;
    if (hash === "#cliente") {
      document.getElementById("cliente-login").style.display = "block";
    } else if (hash === "#dentista") {
      document.getElementById("dentista-login").style.display = "block";
    }

    // Login con Google
    document.getElementById('google-full-login').addEventListener('click', function () {
      const clientId = '449615619408-p8b0rgriusolkp4ktfr8i2j1lqr3rkaf.apps.googleusercontent.com';
      const redirectUri = 'https://tesh249.github.io/clevah/';
      const scope = 'email profile openid';
      const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?response_type=token&client_id=${clientId}&redirect_uri=${redirectUri}&scope=${encodeURIComponent(scope)}&prompt=select_account`;

      window.location.href = authUrl;
    });

  window.addEventListener('load', () => {
  const params = new URLSearchParams(window.location.hash.substring(1));
  const token = params.get('access_token');
  if (token) {
    fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
      headers: {
        Authorization: `Bearer ${token}`
      }
    })
    .then(response => response.json())
    .then(profile => {
      localStorage.setItem('googleToken', token);
      localStorage.setItem('isLoggedIn', 'true');
      localStorage.setItem('userName', profile.name);  // <- Guarda nombre
      window.location.href = 'dashboard-cliente.html';
    });
  }
});

    document.getElementById('dentist-submit').addEventListener('click', function() {
      const email = document.getElementById('dentist-email').value;
      const password = document.getElementById('dentist-password').value;
      if (email && password) {
        localStorage.setItem('isLoggedIn', 'true');
        window.location.href = 'dashboard-dentista.html';
      } else {
        alert('Por favor, ingresa correo y contraseña.');
      }
    });

    document.getElementById('show-register').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('register-form').style.display = 'block';
    });

    document.getElementById('register-submit').addEventListener('click', function() {
      alert('Cuenta creada. Redirigiendo...');
      localStorage.setItem('isLoggedIn', 'true');
      window.location.href = 'dashboard-cliente.html';
    });
  </script>
</body>
</html>
